{
    "version": "https://jsonfeed.org/version/1",
    "title": "This is BlueDog'house • All posts by \"代码\" tag",
    "description": "这里是一个摆烂小狗的happy小屋，随缘更新",
    "home_page_url": "https://bluedog1107.github.io",
    "items": [
        {
            "id": "https://bluedog1107.github.io/%E5%A6%82%E4%BD%95%E5%9C%A8Node-js%E4%B8%AD%E4%BD%BF%E7%94%A8DOM/",
            "url": "https://bluedog1107.github.io/%E5%A6%82%E4%BD%95%E5%9C%A8Node-js%E4%B8%AD%E4%BD%BF%E7%94%A8DOM/",
            "title": "如何在Node.js中使用DOM",
            "date_published": "2023-02-08T05:25:41.000Z",
            "content_html": "<h1 id=\"事件起因\"><a class=\"markdownIt-Anchor\" href=\"#事件起因\">#</a> 事件起因</h1>\n<p>今天在进行 js 代码的学习中，尝试使用 dom 操作，代码如下：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"><span>js代码 </span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'demo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><figure class=\"highlight html\"><figcaption data-lang=\"HTML\"><span>对应html代码</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token doctype\"><span class=\"token punctuation\">&lt;!</span><span class=\"token doctype-tag\">DOCTYPE</span> <span class=\"token name\">html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>../js/test.js<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h1</span><span class=\"token punctuation\">></span></span>通过ID名查找 HTML 元素<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h1</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>demo<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>Hello World<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></pre></td></tr></table></figure><p>本该是正常运行的代码，结果在运行时发生了报错🙃，报错如下：</p>\n<figure class=\"highlight raw\"><figcaption data-lang=\"\"><span>报错信息</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>var x &#x3D; document.getElementById(&#39;demo&#39;);</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        ^</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>ReferenceError: document is not defined</pre></td></tr></table></figure><p>说我没有定义 document 属性，什么情况，于是赶紧求助搜素引擎，在看过众多文章后，发现都说的不是很全面，接下来我就来总结一下。</p>\n<h1 id=\"js运行环境\"><a class=\"markdownIt-Anchor\" href=\"#js运行环境\">#</a> js 运行环境</h1>\n<p>首先，我们来了解一下 js 脚本的运行环境</p>\n<p>js 脚本的运行环境有两种，分别是<span class=\"kbd\">浏览器环境</span>和<span class=\"kbd\"> Node.js 环境</span>，而在上述代码所调用的<span class=\"blue\"> document.getElementById ()</span> 是属于 DOM 的应用，而该应用需要在浏览器环境下才能运行。</p>\n<p>由于我是在 VSCode 中对 js 代码进行编译的使用的是<span class=\"kbd blue\"> Code Runner</span>，其所配置的环境是 Node.js 环境，所以如果有 DOM 操作的话就会报错。</p>\n<h1 id=\"解决方式\"><a class=\"markdownIt-Anchor\" href=\"#解决方式\">#</a> 解决方式</h1>\n<h2 id=\"使用jsdom\"><a class=\"markdownIt-Anchor\" href=\"#使用jsdom\">#</a> 使用 jsdom</h2>\n<p>为了解决 Node.js 无法进行 DOM 操作的问题，官方给出了 jsdom 库来创建虚拟 dom 对象</p>\n<p>安装 jsdom</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>安装jsdom</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">npm</span> i json</pre></td></tr></table></figure><p>修改 js 代码，引入 jsdom 库：</p>\n<figure class=\"highlight js\"><figcaption data-lang=\"JavaScript\"><span>js代码 </span></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> jsdom <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"jsdom\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">const</span> fs <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'fs'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">const</span> path <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">'path'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">const</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token constant\">JSDOM</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span> <span class=\"token operator\">=</span> jsdom<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">// 读取 html</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">const</span> htmlData <span class=\"token operator\">=</span> fs<span class=\"token punctuation\">.</span><span class=\"token function\">readFileSync</span><span class=\"token punctuation\">(</span>path<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">'./html/tstest.html'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span>encoding <span class=\"token operator\">:</span> <span class=\"token string\">'utf-8'</span><span class=\"token punctuation\">,</span>flag <span class=\"token operator\">:</span> <span class=\"token string\">'r'</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 创建 dom 对象</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">const</span> dom <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">JSDOM</span><span class=\"token punctuation\">(</span>htmlData<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token keyword\">const</span> document <span class=\"token operator\">=</span> dom<span class=\"token punctuation\">.</span>window<span class=\"token punctuation\">.</span>document<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">var</span> x <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">getElementById</span><span class=\"token punctuation\">(</span><span class=\"token string\">'demo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>textContent<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>x<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><div class=\"note warning\">\n<p>注意：这里我们在读取 html 文件路径时最好使用<span class=\"kbd red\"> readFileSync ()</span>，因为 readFileSync 能直接将文件数据返回给 htmlData, 如果使用<span class=\"kbd\"> readFile ()</span> 则需要在回调函数中对 htmlData 进行赋值，且由于 js 代码是异步的，接下来的 dom 对象也要放入回调函数中，这样会使代码复杂化。</p>\n</div>\n<p>运行成功</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"><span>安装jsdom</span></figcaption><table><tr><td data-num=\"1\"></td><td><pre>Hello World</pre></td></tr></table></figure>",
            "tags": [
                "代码",
                "node.js",
                "problem"
            ]
        }
    ]
}